const CropWarp=document.querySelector(".Cropper_Wrapper"),el=document.querySelector(".item"),InputImage=document.getElementsByClassName("inputImg")[0],resizers=document.querySelectorAll(".resizer"),resizer=document.querySelector(".resizer"),naW=InputImage.naturalWidth,naH=InputImage.naturalHeight;let bounds,rect,leImg,crXbigining,crYbigining,resizerWidth,canvasWide,cansvasHigh,scale,ImageCover=document.querySelector(".Cropping_IMG"),GetCanvas=document.getElementById("canvas"),isResizing=!1,initialSize=150,pointX=0,pointY=0,start={x:0,y:0};const piCrop=()=>{bounds=CropWarp.getBoundingClientRect(),rect=el.getBoundingClientRect(),leImg=InputImage.getBoundingClientRect(),resizerWidth=resizer.getBoundingClientRect().width,crXbigining=bounds.left,crYbigining=bounds.top,el.style.left=`${(CropWarp.clientWidth-el.clientWidth)/2+crXbigining}px`,el.style.top=`${(CropWarp.clientHeight-el.clientHeight)/2+crYbigining}px`,el.style.width=`${initialSize}px`,el.style.height=`${initialSize}px`,ImageCover.style.width=`${CropWarp.clientWidth}px`,ImageCover.style.top=`${(CropWarp.clientHeight-ImageCover.clientHeight)/2}px`,scale=1};piCrop();const CanVasDimension=()=>{canvasWide=rect.width,cansvasHigh=rect.height,GetCanvas.width=`${canvasWide}`,GetCanvas.height=`${cansvasHigh}`};CanVasDimension();const DrawingImage=()=>{leImg=InputImage.getBoundingClientRect();let e=(rect=el.getBoundingClientRect()).left-leImg.left,t=rect.top-leImg.top,i=e*(naW/leImg.width),n=t*(naH/leImg.height),o=rect.width*(naW/leImg.width),r=rect.height*(naW/leImg.width);const s=new Image,l=GetCanvas.getContext("2d");s.src=InputImage.src,s.addEventListener("load",()=>{l.drawImage(s,i,n,o,r,0,0,canvasWide,cansvasHigh)})};DrawingImage(),window.addEventListener("resize",()=>{piCrop(),CanVasDimension(),DrawingImage()});const ccmf=(e,t)=>{let i=Math.min(Math.max(bounds.left,rect.left-e),bounds.right-rect.width),n=Math.min(Math.max(bounds.top,rect.top-t),bounds.bottom-rect.height);rect.left<=leImg.left?i=Math.min(Math.max(leImg.left,leImg.left-e),bounds.right-rect.width):rect.right>=leImg.left+leImg.width&&(i=Math.min(Math.max(bounds.left,rect.left-e),leImg.left+leImg.width-rect.width)),rect.top<=leImg.top?n=Math.min(Math.max(leImg.top,leImg.top-t),bounds.bottom-rect.height):rect.bottom>=leImg.top+leImg.height&&(n=Math.min(Math.max(bounds.top,rect.top-t),leImg.top+leImg.height-rect.height)),el.style.left=`${i}px`,el.style.top=`${n}px`,DrawingImage()};function touchstart(e){let t=e.touches[0];window.addEventListener("touchmove",o),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",o);window.removeEventListener("touchend",e);window.removeEventListener("touchstart",touchstart)});let i=t.clientX,n=t.clientY;function o(e){let t=e.touches[0];if(!isResizing){let e=i-t.clientX,o=n-t.clientY;Cropper_Container_Movement(e,o),i=t.clientX,n=t.clientY}}}function mousedown(e){el.style.transition="none",window.addEventListener("mousemove",n),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",n);window.removeEventListener("mouseup",e)});let t=e.clientX,i=e.clientY;function n(e){let n=e;if(!isResizing){let e=t-n.clientX,o=i-n.clientY;Cropper_Container_Movement(e,o),t=n.clientX,i=n.clientY}}}el.addEventListener("touchstart",touchstart),el.addEventListener("mousedown",mousedown);const CropperResizer=(e,t,i,n)=>{let o=rect.width,r=rect.height,s=Math.ceil(t.clientX),l=Math.ceil(t.clientY),c=Math.ceil(bounds.right),a=Math.ceil(bounds.left),h=Math.ceil(bounds.top),d=Math.ceil(bounds.bottom);c>=leImg.right&&(c=Math.ceil(leImg.right)),a<=leImg.left&&(a=Math.ceil(leImg.left)),h<=leImg.top&&(h=Math.ceil(leImg.top)),d>=leImg.bottom&&(d=Math.ceil(leImg.bottom));let m=c-rect.left,g=Math.max(resizerWidth,m),p=Math.min(resizerWidth,m),u=d-rect.top,w=Math.max(resizerWidth,u),v=Math.min(resizerWidth,u),I=rect.right-a,f=Math.max(resizerWidth,I),b=Math.min(resizerWidth,I),x=rect.bottom-h,M=Math.max(resizerWidth,x),W=Math.min(resizerWidth,x);e.classList.contains("e")?(o=rect.width-i,s>=c?o=g:s<=rect.left+resizerWidth&&(o=p),el.style.width=`${o}px`):e.classList.contains("se")?(o=rect.width-i,r=rect.height-n,s>=c?o=g:s<=rect.left+resizerWidth&&(o=p),l>=d?r=w:l<=rect.top+resizerWidth&&(r=v),el.style.width=`${o}px`,el.style.height=`${r}px`):e.classList.contains("s")?(r=rect.height-n,l>=d?r=w:l<=rect.top+resizerWidth&&(r=v),el.style.height=`${r}px`):e.classList.contains("sw")?(o=rect.width+i,r=rect.height-n,s<=a?o=f:s>=rect.right-resizerWidth&&(o=b),l>=d?r=w:l<=rect.top+resizerWidth&&(r=v),el.style.width=`${o}px`,el.style.height=`${r}px`,el.style.left=`${rect.right-o}px`):e.classList.contains("w")?(o=rect.width+i,s<=a?o=f:s>=rect.right-resizerWidth&&(o=b),el.style.width=`${o}px`,el.style.left=`${rect.right-o}px`):e.classList.contains("ne")?(o=rect.width-i,r=rect.height+n,s>=c?o=g:s<=rect.left+resizerWidth&&(o=p),l<=h?r=M:l>=rect.bottom-resizerWidth&&(r=W),el.style.width=`${o}px`,el.style.height=`${r}px`,el.style.top=`${rect.bottom-r}px`):e.classList.contains("n")?(r=rect.height+n,l<=h?r=M:l>=rect.bottom-resizerWidth&&(r=W),el.style.height=`${r}px`,el.style.top=`${rect.bottom-r}px`):e.classList.contains("nw")&&(o=rect.width+i,r=rect.height+n,s<=a?o=f:s>=rect.right-resizerWidth&&(o=b),l<=h?r=M:l>=rect.bottom-resizerWidth&&(r=W),el.style.width=`${o}px`,el.style.height=`${r}px`,el.style.top=`${rect.bottom-r}px`,el.style.left=`${rect.right-o}px`),CanVasDimension(),DrawingImage()};for(let e of resizers){function touchstart(e){let t=e.target,i=e.touches[0],n=i.clientX,o=i.clientY;function r(e){isResizing=!0;let i=e.touches[0],r=n-i.clientX,s=o-i.clientY;CropperResizer(t,i,r,s),n=i.clientX,o=i.clientY}window.addEventListener("touchmove",r),window.addEventListener("touchend",function e(){isResizing=!1;window.removeEventListener("touchmove",r);window.removeEventListener("touchend",e)})}function mousedown(e){e.preventDefault();let t=e.target,i=e.clientX,n=e.clientY;function o(e){e.preventDefault(),isResizing=!0;let o=e,r=i-o.clientX,s=n-o.clientY;CropperResizer(t,o,r,s),i=o.clientX,n=o.clientY}window.addEventListener("mousemove",o),window.addEventListener("mouseup",function e(){isResizing=!1;window.removeEventListener("mousemove",o);window.removeEventListener("mouseup",e)})}e.addEventListener("touchstart",touchstart),e.addEventListener("mousedown",mousedown)}const setImageTransForm=()=>{leImg=InputImage.getBoundingClientRect(),bounds=CropWarp.getBoundingClientRect(),rect=el.getBoundingClientRect();let e=naH/naW*bounds.width,t=(leImg.width-bounds.width)/2,i=(leImg.height-e)/2,n=(bounds.height-e)/2,o=(Math.ceil(bounds.top)-bounds.top)*scale;pointX>=rect.left-bounds.left+t?pointX=Math.min(Math.max(pointX,leImg.left),rect.left-bounds.left+t):pointX<=rect.right-bounds.right-t&&(pointX=Math.min(Math.max(pointY,leImg.right),rect.right-bounds.right-t)),pointY>=rect.top-bounds.top-n+i+2*o?pointY=Math.min(Math.max(pointY,leImg.top),rect.top-bounds.top-n+i+2*o):pointY<=rect.bottom-bounds.bottom+n-i+4*o&&(pointY=Math.min(Math.max(pointY,leImg.bottom),rect.bottom-bounds.bottom+n-i+4*o)),ImageCover.style.transform=`translate(${pointX}px, ${pointY}px) scale(${scale})`,DrawingImage()};function IMGmousedown(e){function t(e){pointX=e.clientX-start.x,pointY=e.clientY-start.y,setImageTransForm()}start={x:e.clientX-pointX,y:e.clientY-pointY},window.addEventListener("mousemove",t),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",t);window.removeEventListener("mouseup",e)})}function IMGtouchstart(e){let t=e.touches[0];function i(e){let t=e.touches[0];pointX=t.clientX-start.x,pointY=t.clientY-start.y,setImageTransForm()}start={x:t.clientX-pointX,y:t.clientY-pointY},window.addEventListener("touchmove",i),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",i);window.removeEventListener("touchend",e)})}ImageCover.addEventListener("mousedown",IMGmousedown),ImageCover.addEventListener("touchstart",IMGtouchstart);let CWHolder=document.querySelector(".Cropper_Wrappe_Holder");CWHolder.onwheel=function(e){e.preventDefault(),(e.wheelDelta?e.wheelDelta:-e.deltaY)>0?scale+=.1:scale-=.1,scale=Math.min(Math.max(1,scale),3),setImageTransForm(),rect.height>leImg.height&&(el.style.height=`${leImg.height}px`,el.style.top=`${leImg.top}px`,CanVasDimension())};