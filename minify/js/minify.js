const Cropper_Wrapper=document.querySelector(".Cropper_Wrapper"),el=document.querySelector(".item");let Image_Cover=document.querySelector(".Cropping_IMG");const InputImg=document.getElementsByClassName("inputImg")[0];let GetCanvas=document.getElementById("canvas"),resizer=document.querySelector(".resizer");const resizers=document.querySelectorAll(".resizer"),naW=InputImg.naturalWidth,naH=InputImg.naturalHeight;let bounds,rect,leImg,crXbigining,crYbigining,currentResizer,resizerWidth,scale,isResizing=!1,initialSize=150,pointX=0,pointY=0,start={x:0,y:0};const piCrop=()=>{bounds=Cropper_Wrapper.getBoundingClientRect(),rect=el.getBoundingClientRect(),leImg=InputImg.getBoundingClientRect(),resizerWidth=resizer.getBoundingClientRect().width,crXbigining=bounds.left,crYbigining=bounds.top,el.style.left=`${(Cropper_Wrapper.clientWidth-el.clientWidth)/2+crXbigining}px`,el.style.top=`${(Cropper_Wrapper.clientHeight-el.clientHeight)/2+crYbigining}px`,el.style.width=`${initialSize}px`,el.style.height=`${initialSize}px`,Image_Cover.style.width=`${Cropper_Wrapper.clientWidth}px`,Image_Cover.style.top=`${(Cropper_Wrapper.clientHeight-Image_Cover.clientHeight)/2}px`,GetCanvas.width=`${el.clientWidth}`,GetCanvas.height=`${el.clientHeight}`,scale=1};piCrop();const DrawingImage=()=>{leImg=InputImg.getBoundingClientRect();let e=(rect=el.getBoundingClientRect()).left-leImg.left,t=rect.top-leImg.top,n=e*(naW/leImg.width),i=t*(naH/leImg.height),o=rect.width*(naW/leImg.width),r=rect.height*(naW/leImg.width);const l=new Image,c=GetCanvas.getContext("2d");l.src=InputImg.src,l.addEventListener("load",()=>{c.drawImage(l,n,i,o,r,0,0,el.clientWidth,el.clientHeight)})};DrawingImage(),window.addEventListener("resize",()=>{piCrop(),DrawingImage()});const cll_cropper_movement_function=(e,t)=>{bounds=Cropper_Wrapper.getBoundingClientRect(),rect=el.getBoundingClientRect(),leImg=InputImg.getBoundingClientRect();let n=Math.min(Math.max(bounds.left,rect.left-e),bounds.right-rect.width),i=Math.min(Math.max(bounds.top,rect.top-t),bounds.bottom-rect.height);rect.left<=leImg.left?n=Math.min(Math.max(leImg.left,leImg.left-e),bounds.right-rect.width):rect.right>=leImg.left+leImg.width&&(n=Math.min(Math.max(bounds.left,rect.left-e),leImg.left+leImg.width-rect.width)),rect.top<=leImg.top?i=Math.min(Math.max(leImg.top,leImg.top-t),bounds.bottom-rect.height):rect.bottom>=leImg.top+leImg.height&&(i=Math.min(Math.max(bounds.top,rect.top-t),leImg.top+leImg.height-rect.height)),el.style.left=`${n}px`,el.style.top=`${i}px`,DrawingImage()};function touchstart(e){let t=e.touches[0];window.addEventListener("touchmove",o),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",o);window.removeEventListener("touchend",e);window.removeEventListener("touchstart",touchstart)});let n=t.clientX,i=t.clientY;function o(e){let t=e.touches[0];if(!isResizing){let e=n-t.clientX,o=i-t.clientY;cll_cropper_movement_function(e,o),n=t.clientX,i=t.clientY}}}function mousedown(e){window.addEventListener("mousemove",i),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",i);window.removeEventListener("mouseup",e)});let t=e.clientX,n=e.clientY;function i(e){let i=e;if(!isResizing){let e=t-i.clientX,o=n-i.clientY;cll_cropper_movement_function(e,o),t=i.clientX,n=i.clientY}}}el.addEventListener("touchstart",touchstart),el.addEventListener("mousedown",mousedown);const cll_resizer_function=(e,t,n,i)=>{leImg=InputImg.getBoundingClientRect();let o=(rect=el.getBoundingClientRect()).width,r=rect.height,l=Math.ceil(t.clientX),c=Math.ceil(t.clientY),s=Math.ceil(bounds.right),a=Math.ceil(bounds.left),d=Math.ceil(bounds.top),m=Math.ceil(bounds.bottom);s>=leImg.right&&(s=Math.ceil(leImg.right)),a<=leImg.left&&(a=Math.ceil(leImg.left)),d<=leImg.top&&(d=Math.ceil(leImg.top)),m>=leImg.bottom&&(m=Math.ceil(leImg.bottom));let h=s-rect.left,g=Math.max(resizerWidth,h),u=Math.min(resizerWidth,h),p=m-rect.top,w=Math.max(resizerWidth,p),I=Math.min(resizerWidth,p),v=rect.right-a,f=Math.max(resizerWidth,v),b=Math.min(resizerWidth,v),C=rect.bottom-d,M=Math.max(resizerWidth,C),z=Math.min(resizerWidth,C);e.classList.contains("se")?(o=rect.width-n,r=rect.height-i,l>=s?o=g:l<=rect.left+resizerWidth&&(o=u),c>=m?r=w:c<=rect.top+resizerWidth&&(r=I)):e.classList.contains("sw")?(o=rect.width+n,r=rect.height-i,l<=a?o=f:l>=rect.right-resizerWidth&&(o=b),c>=m?r=w:c<=rect.top+resizerWidth&&(r=I),el.style.left=`${rect.right-o}px`):e.classList.contains("ne")?(o=rect.width-n,r=rect.height+i,l>=s?o=g:l<=rect.left+resizerWidth&&(o=u),c<=d?r=M:c>=rect.bottom-resizerWidth&&(r=z),el.style.top=`${rect.bottom-r}px`):e.classList.contains("nw")&&(o=rect.width+n,r=rect.height+i,l<=a?o=f:l>=rect.right-resizerWidth&&(o=b),c<=d?r=M:c>=rect.bottom-resizerWidth&&(r=z),el.style.top=`${rect.bottom-r}px`,el.style.left=`${rect.right-o}px`),el.style.width=`${o}px`,el.style.height=`${r}px`,GetCanvas.width=`${rect.width}`,GetCanvas.height=`${rect.height}`,DrawingImage()};for(let e of resizers){function touchstart(e){currentResizer=e.target;let t=e.touches[0],n=t.clientX,i=t.clientY;function o(e){isResizing=!0;let t=e.touches[0],o=n-t.clientX,r=i-t.clientY;cll_resizer_function(currentResizer,t,o,r),n=t.clientX,i=t.clientY}window.addEventListener("touchmove",o),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",o);window.removeEventListener("touchend",e);isResizing=!1})}function mousedown(e){currentResizer=e.target;let t=e.clientX,n=e.clientY;function i(e){isResizing=!0;let i=e,o=t-i.clientX,r=n-i.clientY;cll_resizer_function(currentResizer,i,o,r),t=i.clientX,n=i.clientY}window.addEventListener("mousemove",i),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",i);isResizing=!1;window.removeEventListener("mouseup",e)})}e.addEventListener("touchstart",touchstart),e.addEventListener("mousedown",mousedown)}const setImageTransForm=()=>{leImg=InputImg.getBoundingClientRect(),bounds=Cropper_Wrapper.getBoundingClientRect(),rect=el.getBoundingClientRect();let e=naH/naW*bounds.width,t=(leImg.width-bounds.width)/2,n=(leImg.height-e)/2,i=(bounds.height-e)/2,o=(Math.ceil(bounds.top)-bounds.top)*scale;pointX>=rect.left-bounds.left+t?pointX=Math.min(Math.max(pointX,leImg.left),rect.left-bounds.left+t):pointX<=rect.right-bounds.right-t&&(pointX=Math.min(Math.max(pointY,leImg.right),rect.right-bounds.right-t)),pointY>=rect.top-bounds.top-i+n+2*o?pointY=Math.min(Math.max(pointY,leImg.top),rect.top-bounds.top-i+n+2*o):pointY<=rect.bottom-bounds.bottom+i-n+4*o&&(pointY=Math.min(Math.max(pointY,leImg.bottom),rect.bottom-bounds.bottom+i-n+4*o)),Image_Cover.style.transform=`translate(${pointX}px, ${pointY}px) scale(${scale})`,DrawingImage()};function IMGmousedown(e){function t(e){e.preventDefault(),pointX=e.clientX-start.x,pointY=e.clientY-start.y,setImageTransForm()}start={x:e.clientX-pointX,y:e.clientY-pointY},window.addEventListener("mousemove",t),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",t);window.removeEventListener("mouseup",e)})}function IMGtouchstart(e){let t=e.touches[0];function n(e){let t=e.touches[0];pointX=t.clientX-start.x,pointY=t.clientY-start.y,setImageTransForm()}start={x:t.clientX-pointX,y:t.clientY-pointY},window.addEventListener("touchmove",n),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",n);window.removeEventListener("touchend",e)})}Image_Cover.addEventListener("mousedown",IMGmousedown),Image_Cover.addEventListener("touchstart",IMGtouchstart);let Cropper_Wrappe_Holder=document.querySelector(".Cropper_Wrappe_Holder");Cropper_Wrappe_Holder.onwheel=function(e){e.preventDefault(),leImg=InputImg.getBoundingClientRect(),(rect=el.getBoundingClientRect()).height>leImg.height&&piCrop(),(e.wheelDelta?e.wheelDelta:-e.deltaY)>0?scale+=.1:scale-=.1,scale=Math.min(Math.max(1,scale),2.5),setImageTransForm()};