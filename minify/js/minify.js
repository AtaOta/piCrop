const Cropper_Wrapper=document.querySelector(".Cropper_Wrapper"),el=document.querySelector(".item");let Image_Cover=document.querySelector(".Cropping_IMG");const InputImg=document.getElementsByClassName("inputImg")[0];let GetCanvas=document.getElementById("canvas");const naW=InputImg.naturalWidth,naH=InputImg.naturalHeight;let bounds,rect,leImg,crXbigining,crYbigining,scale,isResizing=!1,initialSize=150,pointX=0,pointY=0,start={x:0,y:0};const piCrop=()=>{bounds=Cropper_Wrapper.getBoundingClientRect(),rect=el.getBoundingClientRect(),leImg=InputImg.getBoundingClientRect(),crXbigining=bounds.left,crYbigining=bounds.top,el.style.left=`${(Cropper_Wrapper.clientWidth-el.clientWidth)/2+crXbigining}px`,el.style.top=`${(Cropper_Wrapper.clientHeight-el.clientHeight)/2+crYbigining}px`,el.style.width=`${initialSize}px`,el.style.height=`${initialSize}px`,Image_Cover.style.width=`${Cropper_Wrapper.clientWidth}px`,Image_Cover.style.top=`${(Cropper_Wrapper.clientHeight-Image_Cover.clientHeight)/2}px`,GetCanvas.width=`${el.clientWidth}`,GetCanvas.height=`${el.clientHeight}`,scale=1};piCrop();const DrawingImage=()=>{leImg=InputImg.getBoundingClientRect();let e=(rect=el.getBoundingClientRect()).left-leImg.left,t=rect.top-leImg.top,n=e*(naW/leImg.width),i=t*(naH/leImg.height),o=rect.width*(naW/leImg.width),l=rect.height*(naW/leImg.width);const r=new Image,c=GetCanvas.getContext("2d");r.src=InputImg.src,r.addEventListener("load",()=>{c.drawImage(r,n,i,o,l,0,0,el.clientWidth,el.clientHeight)})};DrawingImage(),window.addEventListener("resize",()=>{piCrop(),DrawingImage()});const cll_cropper_movement_function=(e,t)=>{const n=Cropper_Wrapper.getBoundingClientRect();rect=el.getBoundingClientRect(),leImg=InputImg.getBoundingClientRect();let i=Math.min(Math.max(n.left,rect.left-e),n.right-rect.width),o=Math.min(Math.max(n.top,rect.top-t),n.bottom-rect.height);rect.left<=leImg.left?i=Math.min(Math.max(leImg.left,leImg.left-e),n.right-rect.width):rect.right>=leImg.right&&(i=Math.min(Math.max(n.left,rect.left-e),leImg.right-rect.width)),rect.top<=leImg.top?o=Math.min(Math.max(leImg.top,leImg.top-t),n.bottom-rect.height):rect.bottom>=leImg.bottom&&(o=Math.min(Math.max(n.top,rect.top-t),leImg.bottom-rect.height)),el.style.left=`${i}px`,el.style.top=`${o}px`,DrawingImage()};function touchstart(e){let t=e.touches[0];window.addEventListener("touchmove",o),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",o);window.removeEventListener("touchend",e);window.removeEventListener("touchstart",touchstart)});let n=t.clientX,i=t.clientY;function o(e){let t=e.touches[0];if(!isResizing){let e=n-t.clientX,o=i-t.clientY;cll_cropper_movement_function(e,o),n=t.clientX,i=t.clientY}}}function mousedown(e){window.addEventListener("mousemove",i),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",i);window.removeEventListener("mouseup",e)});let t=e.clientX,n=e.clientY;function i(e){let i=e;if(!isResizing){let e=t-i.clientX,o=n-i.clientY;cll_cropper_movement_function(e,o),t=i.clientX,n=i.clientY}}}el.addEventListener("touchstart",touchstart),el.addEventListener("mousedown",mousedown);const resizers=document.querySelectorAll(".resizer");let currentResizer;const cll_resizer_function=(e,t,n,i,o,l,r,c,s)=>{leImg=InputImg.getBoundingClientRect(),n=el.getBoundingClientRect();let g=leImg.width,p=leImg.height;if(GetCanvas.width=`${n.width}`,GetCanvas.height=`${n.height}`,DrawingImage(),e.classList.contains("se")&&t.clientX<=c&&t.clientY<=s){if(t.clientX>=leImg.left+g)return;if(t.clientY>=leImg.top+p)return;el.style.width=`${n.width-(i-t.clientX)}px`,el.style.height=`${n.height-(o-t.clientY)}px`}else if(e.classList.contains("sw")&&t.clientX>=l&&t.clientY<=s){if(t.clientX<=leImg.left)return;if(t.clientY>=leImg.top+p)return;el.style.width=`${n.width+(i-t.clientX)}px`,el.style.height=`${n.height-(o-t.clientY)}px`,el.style.left=`${n.left-(i-t.clientX)}px`}else if(e.classList.contains("ne")&&t.clientX<c&&t.clientY>=r){if(t.clientX>=leImg.left+g)return;if(t.clientY<=leImg.top)return;el.style.width=`${n.width-(i-t.clientX)}px`,el.style.height=`${n.height+(o-t.clientY)}px`,el.style.top=`${n.top-(o-t.clientY)}px`}else if(e.classList.contains("nw")&&t.clientX>=l&&t.clientY>=r){if(t.clientX<=leImg.left)return;if(t.clientY<=leImg.top)return;el.style.width=`${n.width+(i-t.clientX)}px`,el.style.height=`${n.height+(o-t.clientY)}px`,el.style.top=`${n.top-(o-t.clientY)}px`,el.style.left=`${n.left-(i-t.clientX)}px`}};for(let e of resizers){function touchstart(t){currentResizer=t.target;let n=t.touches[0],i=n.clientX,o=n.clientY;window.addEventListener("touchmove",d),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",d);window.removeEventListener("touchend",e);isResizing=!1});let l=3*e.clientWidth,r=Cropper_Wrapper.getBoundingClientRect(),c=r.left,s=r.top,g=Cropper_Wrapper.clientWidth,p=Cropper_Wrapper.clientHeight,h=r.left+g,a=r.top+p;function d(e){isResizing=!0;let t=e.touches[0];const n=el.getBoundingClientRect();n.width<=g&&n.height<=p&&n.width>=l&&n.height>=l?(cll_resizer_function(currentResizer,t,n,i,o,c,s,h,a),i=t.clientX,o=t.clientY):n.width>g?el.style.width=`${g}px`:n.height>p?el.style.height=`${p}px`:n.width<l?el.style.width=`${l}px`:n.height<l&&(el.style.height=`${l}px`)}}function mousedown(t){currentResizer=t.target;let n=t.clientX,i=t.clientY;window.addEventListener("mousemove",a),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",a);window.removeEventListener("mouseup",e);isResizing=!1});let o=3*e.clientWidth,l=Cropper_Wrapper.getBoundingClientRect(),r=l.left,c=l.top,s=Cropper_Wrapper.clientWidth,g=Cropper_Wrapper.clientHeight,p=l.left+s,h=l.top+g;function a(e){isResizing=!0;let t=e;const l=el.getBoundingClientRect();l.width<=s&&l.height<=g&&l.width>=o&&l.height>=o?(cll_resizer_function(currentResizer,t,l,n,i,r,c,p,h),n=t.clientX,i=t.clientY):l.width>s?el.style.width=`${s}px`:l.height>g?el.style.height=`${g}px`:l.width<o?el.style.width=`${o}px`:l.height<o&&(el.style.height=`${o}px`)}}e.addEventListener("touchstart",touchstart),e.addEventListener("mousedown",mousedown)}const setImageTransForm=()=>{leImg=InputImg.getBoundingClientRect(),bounds=Cropper_Wrapper.getBoundingClientRect(),rect=el.getBoundingClientRect();let e=Math.ceil(naH/naW*bounds.width),t=Math.ceil((leImg.width-bounds.width)/2),n=Math.ceil((leImg.height-e)/2),i=Math.ceil((bounds.height-e)/2);pointX>=rect.left-bounds.left+t?pointX=Math.min(Math.max(pointX,leImg.left),rect.left-bounds.left+t):pointX<=rect.right-bounds.right-t&&(pointX=Math.min(Math.max(pointY,leImg.right),rect.right-bounds.right-t)),pointY>=rect.top-bounds.top-i+n?pointY=Math.min(Math.max(pointY,leImg.top),rect.top-bounds.top-i+n):pointY<=rect.bottom-bounds.bottom+i-n&&(pointY=Math.min(Math.max(pointY,leImg.bottom),rect.bottom-bounds.bottom+i-n)),Image_Cover.style.transform=`translate(${pointX}px, ${pointY}px) scale(${scale})`,DrawingImage()};function IMGmousedown(e){function t(e){e.preventDefault(),pointX=e.clientX-start.x,pointY=e.clientY-start.y,setImageTransForm()}start={x:e.clientX-pointX,y:e.clientY-pointY},window.addEventListener("mousemove",t),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",t);window.removeEventListener("mouseup",e)})}function IMGtouchstart(e){let t=e.touches[0];function n(e){let t=e.touches[0];pointX=t.clientX-start.x,pointY=t.clientY-start.y,setImageTransForm()}start={x:t.clientX-pointX,y:t.clientY-pointY},window.addEventListener("touchmove",n),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",n);window.removeEventListener("touchend",e)})}Image_Cover.addEventListener("mousedown",IMGmousedown),Image_Cover.addEventListener("touchstart",IMGtouchstart);let Cropper_Wrappe_Holder=document.querySelector(".Cropper_Wrappe_Holder");Cropper_Wrappe_Holder.onwheel=function(e){e.preventDefault(),leImg=InputImg.getBoundingClientRect(),(rect=el.getBoundingClientRect()).height>leImg.height&&piCrop(),(e.wheelDelta?e.wheelDelta:-e.deltaY)>0?scale+=.1:scale-=.1,scale=Math.min(Math.max(1,scale),2.5),setImageTransForm()};