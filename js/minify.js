const Cropper_Wrapper=document.querySelector(".Cropper_Wrapper");let Cropper_Wrapper_Rect=Cropper_Wrapper.getBoundingClientRect(),crXbigining=Cropper_Wrapper_Rect.left,crYbigining=Cropper_Wrapper_Rect.top;const el=document.querySelector(".item");el.style.left=`${(Cropper_Wrapper.clientWidth-el.clientWidth)/2+crXbigining}px`,el.style.top=`${(Cropper_Wrapper.clientHeight-el.clientHeight)/2+crYbigining}px`;let rect=el.getBoundingClientRect(),Cropping_IMG=document.querySelector(".Cropping_IMG"),leImg=Cropping_IMG.getBoundingClientRect();Cropping_IMG.style.width=`${Cropper_Wrapper_Rect.width}px`,Cropping_IMG.style.top=`${(Cropper_Wrapper_Rect.height-leImg.height)/2}px`;let InputImg=document.getElementsByClassName("inputImg")[0],GetCanvas=document.getElementById("canvas");GetCanvas.width=`${el.clientWidth}`,GetCanvas.height=`${el.clientHeight}`;let isResizing=!1,scale=1,scaleDireaction=0;const DrawingImage=()=>{leImg=Cropping_IMG.getBoundingClientRect(),rect=el.getBoundingClientRect(),InputImg=document.getElementsByClassName("inputImg")[0];let e=rect.left-leImg.left,t=rect.top-leImg.top;const i=InputImg.naturalWidth,n=InputImg.naturalHeight;let l=e*(i/leImg.width),r=t*(n/leImg.height),o=rect.width*(i/leImg.width),p=rect.height*(i/leImg.width);const c=new Image,s=GetCanvas.getContext("2d");c.src=InputImg.src,c.addEventListener("load",()=>{s.drawImage(c,l,r,o,p,0,0,el.clientWidth,el.clientHeight)})};function zoom(e){e.preventDefault(),Cropper_Wrapper_Rect=Cropper_Wrapper.getBoundingClientRect(),Cropping_IMG=document.querySelector(".Cropping_IMG"),leImg=Cropping_IMG.getBoundingClientRect(),scale+=-.001*e.deltaY,scaleDireaction=-.01*e.deltaY,(scale=Math.min(Math.max(1,scale.toFixed(1)),1.5))<=1?Cropping_IMG.style.width=`${Cropper_Wrapper_Rect.width}px`:scale>1&&scaleDireaction<0?Cropping_IMG.style.width=`${leImg.width/(scale+.1)}px`:scaleDireaction>0&&scale<1.5&&scale>1?Cropping_IMG.style.width=`${leImg.width*scale}px`:DrawingImage()}DrawingImage(),Cropping_IMG.onwheel=zoom,window.addEventListener("resize",()=>{el.getBoundingClientRect();el.style.width="100px",el.style.height="100px";let e=(Cropper_Wrapper_Rect=Cropper_Wrapper.getBoundingClientRect()).left,t=Cropper_Wrapper_Rect.top;el.style.left=`${(Cropper_Wrapper.clientWidth-el.clientWidth)/2+e}px`,el.style.top=`${(Cropper_Wrapper.clientHeight-el.clientHeight)/2+t}px`,Cropping_IMG.style.width=`${Cropper_Wrapper.clientWidth}px`,Cropping_IMG.style.top=`${(Cropper_Wrapper.clientHeight-Cropping_IMG.clientHeight)/2}px`,leImg=Cropping_IMG.getBoundingClientRect(),GetCanvas.width=`${el.clientWidth}`,GetCanvas.height=`${el.clientHeight}`,scale=1,scaleDireaction=0,DrawingImage()});const cll_cropper_movement_function=(e,t)=>{Cropper_Wrapper_Rect=Cropper_Wrapper.getBoundingClientRect(),rect=el.getBoundingClientRect(),leImg=Cropping_IMG.getBoundingClientRect();let i=Cropper_Wrapper_Rect.left,n=Cropper_Wrapper_Rect.top,l=Cropper_Wrapper_Rect.left+Cropper_Wrapper_Rect.width,r=Cropper_Wrapper_Rect.top+Cropper_Wrapper_Rect.height,o=rect.top,p=rect.left,c=rect.width,s=rect.height;el.style.left=`${p-e}px`,el.style.top=`${o-t}px`,DrawingImage(),p<i?el.style.left=`${i}px`:o<n?el.style.top=`${n}px`:p+c>l?el.style.left=`${l-c}px`:o+s>r?el.style.top=`${r-s}px`:p<leImg.left?el.style.left=`${leImg.left}px`:o<leImg.top?el.style.top=`${leImg.top}px`:p+c>leImg.left+leImg.width?el.style.left=`${leImg.left+leImg.width-c}px`:o+s>leImg.top+leImg.height-5&&(el.style.top=`${leImg.top+leImg.height-s-5}px`)};function touchstart(e){let t=e.touches[0];window.addEventListener("touchmove",l),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",l);window.removeEventListener("touchend",e);window.removeEventListener("touchstart",touchstart)});let i=t.clientX,n=t.clientY;function l(e){let t=e.touches[0];if(!isResizing){let e=i-t.clientX,l=n-t.clientY;cll_cropper_movement_function(e,l),i=t.clientX,n=t.clientY}}}function mousedown(e){window.addEventListener("mousemove",n),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",n);window.removeEventListener("mouseup",e)});let t=e.clientX,i=e.clientY;function n(e){let n=e;if(!isResizing){let e=t-n.clientX,l=i-n.clientY;cll_cropper_movement_function(e,l),t=n.clientX,i=n.clientY}}}el.addEventListener("touchstart",touchstart),el.addEventListener("mousedown",mousedown);const resizers=document.querySelectorAll(".resizer");let currentResizer;const cll_resizer_function=(e,t,i,n,l,r,o,p,c)=>{leImg=Cropping_IMG.getBoundingClientRect(),i=el.getBoundingClientRect();let s=leImg.width,g=leImg.height;if(GetCanvas.width=`${i.width}`,GetCanvas.height=`${i.height}`,DrawingImage(),e.classList.contains("se")&&t.clientX<=p&&t.clientY<=c){if(t.clientX>=leImg.left+s)return;if(t.clientY>=leImg.top+g)return;el.style.width=`${i.width-(n-t.clientX)}px`,el.style.height=`${i.height-(l-t.clientY)}px`}else if(e.classList.contains("sw")&&t.clientX>=r&&t.clientY<=c){if(t.clientX<=leImg.left)return;if(t.clientY>=leImg.top+g)return;el.style.width=`${i.width+(n-t.clientX)}px`,el.style.height=`${i.height-(l-t.clientY)}px`,el.style.left=`${i.left-(n-t.clientX)}px`}else if(e.classList.contains("ne")&&t.clientX<p&&t.clientY>=o){if(t.clientX>=leImg.left+s)return;if(t.clientY<=leImg.top)return;el.style.width=`${i.width-(n-t.clientX)}px`,el.style.height=`${i.height+(l-t.clientY)}px`,el.style.top=`${i.top-(l-t.clientY)}px`}else if(e.classList.contains("nw")&&t.clientX>=r&&t.clientY>=o){if(t.clientX<=leImg.left)return;if(t.clientY<=leImg.top)return;el.style.width=`${i.width+(n-t.clientX)}px`,el.style.height=`${i.height+(l-t.clientY)}px`,el.style.top=`${i.top-(l-t.clientY)}px`,el.style.left=`${i.left-(n-t.clientX)}px`}};for(let e of resizers){function touchstart(t){currentResizer=t.target;let i=t.touches[0],n=i.clientX,l=i.clientY;window.addEventListener("touchmove",a),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",a);window.removeEventListener("touchend",e);isResizing=!1});let r=3*e.clientWidth,o=Cropper_Wrapper.getBoundingClientRect(),p=o.left,c=o.top,s=Cropper_Wrapper.clientWidth,g=Cropper_Wrapper.clientHeight,d=o.left+s,h=o.top+g;function a(e){isResizing=!0;let t=e.touches[0];const i=el.getBoundingClientRect();i.width<=s&&i.height<=g&&i.width>=r&&i.height>=r?(cll_resizer_function(currentResizer,t,i,n,l,p,c,d,h),n=t.clientX,l=t.clientY):i.width>s?el.style.width=`${s}px`:i.height>g?el.style.height=`${g}px`:i.width<r?el.style.width=`${r}px`:i.height<r&&(el.style.height=`${r}px`)}}function mousedown(t){currentResizer=t.target;let i=t.clientX,n=t.clientY;window.addEventListener("mousemove",h),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",h);window.removeEventListener("mouseup",e);isResizing=!1});let l=3*e.clientWidth,r=Cropper_Wrapper.getBoundingClientRect(),o=r.left,p=r.top,c=Cropper_Wrapper.clientWidth,s=Cropper_Wrapper.clientHeight,g=r.left+c,d=r.top+s;function h(e){isResizing=!0;let t=e;const r=el.getBoundingClientRect();r.width<=c&&r.height<=s&&r.width>=l&&r.height>=l?(cll_resizer_function(currentResizer,t,r,i,n,o,p,g,d),i=t.clientX,n=t.clientY):r.width>c?el.style.width=`${c}px`:r.height>s?el.style.height=`${s}px`:r.width<l?el.style.width=`${l}px`:r.height<l&&(el.style.height=`${l}px`)}}e.addEventListener("touchstart",touchstart),e.addEventListener("mousedown",mousedown)}const PostionImage=(e,t)=>{Cropper_Wrapper_Rect=Cropper_Wrapper.getBoundingClientRect();let i=Cropping_IMG.getBoundingClientRect(),n=el.getBoundingClientRect(),l=n.height,r=n.width,o=n.top,p=n.left,c=i.height,s=i.width,g=i.top,d=i.left,h=Cropper_Wrapper_Rect.top,a=Cropper_Wrapper_Rect.left,u=o+l-(c+h),m=g+c,w=o+l,_=p+r-(s+a),C=d+s,I=p+r;Cropping_IMG.style.left=`${d-e-a}px`,Cropping_IMG.style.top=`${g-t-h}px`,DrawingImage(),d>p?Cropping_IMG.style.left=`${p-a}px`:g>o?Cropping_IMG.style.top=`${o-h}px`:m<w+5?Cropping_IMG.style.top=`${u+5}px`:C<I&&(Cropping_IMG.style.left=`${_}px`)};function IMGmousedown(e){let t=e.clientX,i=e.clientY;function n(e){let n=t-e.clientX,l=i-e.clientY;PostionImage(n,l),t=e.clientX,i=e.clientY}window.addEventListener("mousemove",n),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",n);window.removeEventListener("mouseup",e)})}function IMGtouchstart(e){let t=e.touches[0],i=t.clientX,n=t.clientY;function l(e){let t=e.touches[0],l=i-t.clientX,r=n-t.clientY;PostionImage(l,r),i=t.clientX,n=t.clientY}window.addEventListener("touchmove",l),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",l);window.removeEventListener("touchend",e)})}Cropping_IMG.addEventListener("mousedown",IMGmousedown),Cropping_IMG.addEventListener("touchstart",IMGtouchstart);