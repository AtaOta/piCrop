const Cropper_Wrapper=document.querySelector(".Cropper_Wrapper");let Cropper_Wrapper_Dimension=Cropper_Wrapper.getBoundingClientRect(),crXbigining=Cropper_Wrapper_Dimension.left,crYbigining=Cropper_Wrapper_Dimension.top;const el=document.querySelector(".item");el.style.left=`${(Cropper_Wrapper.clientWidth-el.clientWidth)/2+crXbigining}px`,el.style.top=`${(Cropper_Wrapper.clientHeight-el.clientHeight)/2+crYbigining}px`;let rect=el.getBoundingClientRect(),Cropping_IMG=document.querySelector(".Cropping_IMG");Cropping_IMG.style.width=`${Cropper_Wrapper.clientWidth}px`,Cropping_IMG.style.top=`${(Cropper_Wrapper.clientHeight-Cropping_IMG.clientHeight)/2}px`;let leImg=Cropping_IMG.getBoundingClientRect(),InputImg=document.getElementsByClassName("inputImg")[0],DrawFormLeft=rect.left-leImg.left,DrawFormTop=rect.top-leImg.top,GetCanvas=document.getElementById("canvas");GetCanvas.width=`${el.clientWidth}`,GetCanvas.height=`${el.clientHeight}`;let isResizing=!1;const DrawingImage=(e,t)=>{const i=(InputImg=document.getElementsByClassName("inputImg")[0]).naturalWidth,n=InputImg.naturalHeight;let l=e*(i/Cropping_IMG.clientWidth),o=t*(n/Cropping_IMG.clientHeight),r=el.clientWidth*(i/Cropping_IMG.clientWidth),p=el.clientHeight*(i/Cropping_IMG.clientWidth);const c=new Image,s=GetCanvas.getContext("2d");c.src=InputImg.src,c.addEventListener("load",()=>{s.drawImage(c,l,o,r,p,0,0,el.clientWidth,el.clientHeight)})};DrawingImage(DrawFormLeft,DrawFormTop),window.addEventListener("resize",()=>{el.getBoundingClientRect();el.style.width="100px",el.style.height="100px";let e=(Cropper_Wrapper_Dimension=Cropper_Wrapper.getBoundingClientRect()).left,t=Cropper_Wrapper_Dimension.top;el.style.left=`${(Cropper_Wrapper.clientWidth-el.clientWidth)/2+e}px`,el.style.top=`${(Cropper_Wrapper.clientHeight-el.clientHeight)/2+t}px`,Cropping_IMG.style.width=`${Cropper_Wrapper.clientWidth}px`,Cropping_IMG.style.top=`${(Cropper_Wrapper.clientHeight-Cropping_IMG.clientHeight)/2}px`,leImg=Cropping_IMG.getBoundingClientRect()});const cll_cropper_movement_function=(e,t)=>{let i=Cropper_Wrapper.getBoundingClientRect(),n=i.left,l=i.top,o=i.left+Cropper_Wrapper.clientWidth,r=i.top+Cropper_Wrapper.clientHeight;rect=el.getBoundingClientRect(),leImg=Cropping_IMG.getBoundingClientRect();let p=rect.top,c=rect.left,s=el.clientWidth,g=el.clientHeight;el.style.left=`${c-e}px`,el.style.top=`${p-t}px`,DrawFormLeft=rect.left-leImg.left,DrawFormTop=rect.top-leImg.top,DrawingImage(DrawFormLeft,DrawFormTop),c<n?el.style.left=`${n}px`:p<l?el.style.top=`${l}px`:c+s>o?el.style.left=`${o-s}px`:p+g>r?el.style.top=`${r-g}px`:c<leImg.left?el.style.left=`${leImg.left}px`:p<leImg.top?el.style.top=`${leImg.top}px`:c+s>leImg.left+Cropping_IMG.clientWidth?el.style.left=`${leImg.left+Cropping_IMG.clientWidth-el.clientWidth}px`:p+g>leImg.top+Cropping_IMG.clientHeight-5&&(el.style.top=`${leImg.top+Cropping_IMG.clientHeight-el.clientHeight-5}px`)};function touchstart(e){let t=e.touches[0];window.addEventListener("touchmove",l),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",l);window.removeEventListener("touchend",e);window.removeEventListener("touchstart",touchstart)});let i=t.clientX,n=t.clientY;function l(e){let t=e.touches[0];if(!isResizing){let e=i-t.clientX,l=n-t.clientY;cll_cropper_movement_function(e,l),i=t.clientX,n=t.clientY}}}function mousedown(e){window.addEventListener("mousemove",n),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",n);window.removeEventListener("mouseup",e)});let t=e.clientX,i=e.clientY;function n(e){let n=e;if(!isResizing){let e=t-n.clientX,l=i-n.clientY;cll_cropper_movement_function(e,l),t=n.clientX,i=n.clientY}}}el.addEventListener("touchstart",touchstart),el.addEventListener("mousedown",mousedown);const resizers=document.querySelectorAll(".resizer");let currentResizer;const cll_resizer_function=(e,t,i,n,l,o,r,p,c)=>{leImg=Cropping_IMG.getBoundingClientRect();let s=Cropping_IMG.clientWidth,g=Cropping_IMG.clientHeight;if(GetCanvas.width=`${el.clientWidth}`,GetCanvas.height=`${el.clientHeight}`,DrawFormLeft=i.left-leImg.left,DrawFormTop=i.top-leImg.top,DrawingImage(DrawFormLeft,DrawFormTop),e.classList.contains("se")&&t.clientX<=p&&t.clientY<=c){if(t.clientX>=leImg.left+s)return;if(t.clientY>=leImg.top+g)return;el.style.width=`${i.width-(n-t.clientX)}px`,el.style.height=`${i.height-(l-t.clientY)}px`}else if(e.classList.contains("sw")&&t.clientX>=o&&t.clientY<=c){if(t.clientX<=leImg.left)return;if(t.clientY>=leImg.top+g)return;el.style.width=`${i.width+(n-t.clientX)}px`,el.style.height=`${i.height-(l-t.clientY)}px`,el.style.left=`${i.left-(n-t.clientX)}px`}else if(e.classList.contains("ne")&&t.clientX<p&&t.clientY>=r){if(t.clientX>=leImg.left+s)return;if(t.clientY<=leImg.top)return;el.style.width=`${i.width-(n-t.clientX)}px`,el.style.height=`${i.height+(l-t.clientY)}px`,el.style.top=`${i.top-(l-t.clientY)}px`}else if(e.classList.contains("nw")&&t.clientX>=o&&t.clientY>=r){if(t.clientX<=leImg.left)return;if(t.clientY<=leImg.top)return;el.style.width=`${i.width+(n-t.clientX)}px`,el.style.height=`${i.height+(l-t.clientY)}px`,el.style.top=`${i.top-(l-t.clientY)}px`,el.style.left=`${i.left-(n-t.clientX)}px`}};for(let e of resizers){function touchstart(t){currentResizer=t.target;let i=t.touches[0],n=i.clientX,l=i.clientY;window.addEventListener("touchmove",m),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",m);window.removeEventListener("touchend",e);isResizing=!1});let o=3*e.clientWidth,r=Cropper_Wrapper.getBoundingClientRect(),p=r.left,c=r.top,s=Cropper_Wrapper.clientWidth,g=Cropper_Wrapper.clientHeight,d=r.left+s,h=r.top+g;function m(e){isResizing=!0;let t=e.touches[0];const i=el.getBoundingClientRect();i.width<=s&&i.height<=g&&i.width>=o&&i.height>=o?(cll_resizer_function(currentResizer,t,i,n,l,p,c,d,h),n=t.clientX,l=t.clientY):i.width>s?el.style.width=`${s}px`:i.height>g?el.style.height=`${g}px`:i.width<o?el.style.width=`${o}px`:i.height<o&&(el.style.height=`${o}px`)}}function mousedown(t){currentResizer=t.target;let i=t.clientX,n=t.clientY;window.addEventListener("mousemove",h),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",h);window.removeEventListener("mouseup",e);isResizing=!1});let l=3*e.clientWidth,o=Cropper_Wrapper.getBoundingClientRect(),r=o.left,p=o.top,c=Cropper_Wrapper.clientWidth,s=Cropper_Wrapper.clientHeight,g=o.left+c,d=o.top+s;function h(e){isResizing=!0;let t=e;const o=el.getBoundingClientRect();o.width<=c&&o.height<=s&&o.width>=l&&o.height>=l?(cll_resizer_function(currentResizer,t,o,i,n,r,p,g,d),i=t.clientX,n=t.clientY):o.width>c?el.style.width=`${c}px`:o.height>s?el.style.height=`${s}px`:o.width<l?el.style.width=`${l}px`:o.height<l&&(el.style.height=`${l}px`)}}e.addEventListener("touchstart",touchstart),e.addEventListener("mousedown",mousedown)}const PostionImage=(e,t)=>{let i=Cropping_IMG.getBoundingClientRect(),n=el.getBoundingClientRect(),l=el.clientHeight,o=el.clientWidth,r=Cropping_IMG.clientHeight,p=Cropping_IMG.clientWidth,c=n.top+l-(r+Cropper_Wrapper_Dimension.top),s=i.top+r,g=n.top+l,d=n.left+o-(p+Cropper_Wrapper_Dimension.left),h=i.left+p,m=n.left+o;Cropping_IMG.style.left=`${i.left-e-Cropper_Wrapper_Dimension.left}px`,Cropping_IMG.style.top=`${i.top-t-Cropper_Wrapper_Dimension.top}px`,DrawFormLeft=rect.left-i.left,DrawFormTop=rect.top-i.top,DrawingImage(DrawFormLeft,DrawFormTop),i.left>n.left?Cropping_IMG.style.left=`${n.left-Cropper_Wrapper_Dimension.left}px`:i.top>n.top?Cropping_IMG.style.top=`${n.top-Cropper_Wrapper_Dimension.top}px`:s<g?Cropping_IMG.style.top=`${c}px`:h<m&&(Cropping_IMG.style.left=`${d}px`)};function IMGmousedown(e){let t=e.clientX,i=e.clientY;function n(e){let n=t-e.clientX,l=i-e.clientY;PostionImage(n,l),t=e.clientX,i=e.clientY}window.addEventListener("mousemove",n),window.addEventListener("mouseup",function e(){window.removeEventListener("mousemove",n);window.removeEventListener("mouseup",e)})}function IMGtouchstart(e){let t=e.touches[0],i=t.clientX,n=t.clientY;function l(e){let t=e.touches[0],l=i-t.clientX,o=n-t.clientY;PostionImage(l,o),i=t.clientX,n=t.clientY}window.addEventListener("touchmove",l),window.addEventListener("touchend",function e(){window.removeEventListener("touchmove",l);window.removeEventListener("touchend",e)})}Cropping_IMG.addEventListener("mousedown",IMGmousedown),Cropping_IMG.addEventListener("touchstart",IMGtouchstart);